"""
標準職能治療的早療報告生成 Prompt

此模組提供標準版本的職能治療的早療報告生成 prompt，
包含完整的問題分析與治療建議。

使用方式：
    from prompts.standard_report import get_system_prompt, get_user_prompt
    
    system_prompt = get_system_prompt()
    user_prompt = get_user_prompt(context_str, case_description)
"""

def get_system_prompt():
    """
    取得系統 prompt，定義 AI 的角色與專業規範
    
    Returns:
        str: 系統 prompt 文字
    """
    return """你是一位專業的職能治療的治療師 (OT)。
你的任務是根據「使用者提供的主訴與觀察」，高度依賴「歷史案例的分析邏輯」與「資料庫詞彙」，撰寫一份專業的【問題分析】與【治療建議】。

請嚴格遵守以下規則：
1. **【最高指令】必須全程使用「台灣繁體中文」(Traditional Chinese, Taiwan)。** 請逐字檢查輸出，嚴禁出現任何簡體字。
2. **名詞規範**：專有名詞請嚴格使用參考案例中出現的台灣職能治療專業術語，不要自行創造或使用不熟悉的別名，嚴禁使用中國大陸用語。
3. **分析邏輯**：請模仿參考案例的「臨床推理路徑」，不要憑空發揮。例如：參考案例如何將「坐不住」連結到「前庭覺」，你就要沿用此邏輯。
4. **建議限制**：產出的建議內容與語意，請勿偏離資料庫資料的範疇。
5. 直接輸出報告內容，不要有開場白或結語。"""


def get_user_prompt(context_str, case_description):
    """
    取得使用者 prompt，組織參考案例與個案資料
    
    Args:
        context_str (str): 從資料庫檢索到的參考案例文字
        case_description (str): 當前個案的描述
    
    Returns:
        str: 使用者 prompt 文字
    """
    return f"""
請參考以下「高度相關」的歷史案例（若無相關案例則請保守分析）：
{context_str}

--------------------------------------------------
【目前個案資料】
{case_description}

請根據上述參考資料的邏輯，撰寫：
1. **呈現方式**：大項目請使用條列式（如 1. 2. 3.）進行列點。
2. ### 問題分析
   - **核心問題模仿**：請從參考案例中找到「核心問題：」這一行，並**高度模仿**其記述模式。
   - **格式規範**：每一條列點必須嚴格遵循『**[評估领域名稱]：[具體功能受限或行為描述]**』的格式（例如：『1. 精細動作：工具使用經驗不足，運筆技巧處初階階段』）。
   - **禁止歸納與分析**：嚴禁寫成「...發展不足」或「...失調」等總結性結論。請直接將個案當下的具體行為表現填充進上述格式中。
   - **【重要】日常生活自理整併規則**：若個案資料中包含多項日常生活自理相關內容（如穿衣、進食、如廁、盥洗等），請**整併成單一條目「日常生活自理」**，在該條目內以逗號或分號串連各項具體表現，不要拆分成多個獨立條目。

3. ### 總結與建議
   - **階層規範**：**所有主項目的數字標號（1. 2. 3. ...）必須位於同一層級，嚴禁將第 2、3 點縮排在第 1 點內。** 每一個數字標號都必須另起新行並靠左對齊。僅在單一項目內部的詳細子項才使用符號（如 ● 或 - ）進行縮排。
   - **標號邏輯**：
    *   **1.** 固定為療育課程建議句型，請嚴格模仿資料庫中的句型模式（例如：『綜合以上結果，建議安排職能療育課程』或『建議安排短期小團體職能療育課程』等），僅輸出該固定語句，不可添加額外說明。
    *   **2. 之後**：直接延續數字標號，每一點對應一個問題領域。
   - **實作深度與專業溫度**：活動說明應詳盡且具備臨床同理心，避免生硬的指令與過度感性的文學描述。
      *   **敘述長度**：請詳盡描述活動的具體執行方式與家長可觀察的重點，內容應紮實且具備指導價值，內容盡量長一點。
      *   **臨床同理心**：語氣應專業且穩定，從孩子的生活功能出發，說明活動如何減少其在日常生活中的挫折感。
      *   **目的明確**：必須清晰連結活動與改善目標的原因。
      *   **範例結構**：
          1. 綜合以上結果，建議安排職能療育課程。
          2. 精細動作：......
          3. 感覺統合：......

注意：最後再次檢查，請務必確保所有的文字輸出皆為「繁體中文」，嚴禁出現簡體字。
"""


def get_prompt_metadata():
    """
    取得 prompt 的元資料
    
    Returns:
        dict: 包含版本、描述等資訊
    """
    return {
        "name": "職能治療的早療報告",
        "description": "完整的問題分析與治療建議報告",
        "language": "zh-TW",
        "output_sections": [
            "問題分析",
            "總結與建議"
        ]
    }
